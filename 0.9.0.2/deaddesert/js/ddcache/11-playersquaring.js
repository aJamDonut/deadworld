bootStrap.push(function(){game.tools.setPlayerSquaringTool=function(a){console.log("TOOOOL",a),game.ui.pinnedTool=!1,game.ui.pinningTool&&"function"==typeof game.ui.pinningTool.reset&&game.ui.pinningTool.reset(),a.layer&&(game.drawLayer=a.layer),game.tools.deactivate();var b=new Tool(a.name);b.hoverBricks=[],a.across=1,a.down=1,b.data=a,b.type="playersquaring",b.canCommit=!0,b.tempBricks={},b.wallHolder=function(a,b){var c=0*game.tileSize,d=(5-1)*game.tileSize,e=new WorldObject(a,b,game.render.newTexture(game.render.tilesets.background,c,d,game.tileSize,game.tileSize));e.x=a,e.y=b,this.cancommit=game.grid.validBuildZone(a,b),game.render.objectLayer.addChild(e),this.hoverBricks.push(e)},b.floorHolder=function(a,b){var c=1,d=12;!0===this.data.data.buildFloor&&(c=this.data.across,d=this.data.down),this.data.data.across!==void 0&&(c=this.data.data.across,d=this.data.data.down);var e=(c-1)*game.tileSize,f=(d-1)*game.tileSize,g=new WorldObject(a,b,game.render.newTexture(game.render.tilesets.background,e,f,game.tileSize,game.tileSize));g.x=a,g.y=b,!0!==this.data.data.wallBuild&&3<=game.drawMatrix[game.gridPos(a)][game.gridPos(b)][0]&&2<=game.drawMatrix[game.gridPos(a)][game.gridPos(b)][1]&&(this.canCommit=!1,g.tint=16711680,"allowwall"==this.data.collide&&"brickholder"==game.world.objects[i].name&&(this.cancommit=!0)),game.render.objectLayer.addChild(g),this.hoverBricks.push(g)},b.fill=function(a,b,c,d){void 0===c&&(c=.25);var e=1,f=12;!0===this.data.data.buildFloor&&(e=this.data.across,f=this.data.down);var g=(e-1)*game.tileSize,h=(f-1)*game.tileSize,k=!0;if(!1===this.canCommit&&(k=!1),!0===k){var l=new WorldObject(a,b,game.render.newTexture(game.render.tilesets.background,g,h,game.tileSize,game.tileSize));l.data=!0===this.data.data.buildFloor?game.clone(this.data.data):{buildFloor:!0,across:1,down:8},l.x=a,l.y=b,l.across=e,l.down=f,l.alpha=c,l.name="floorholder",console.log("Fill"),game.grid.updateTile(game.gridPos(a),game.gridPos(b),d[0],d[1],game.drawLayer),l.destroy()}},b.commitFloor=function(a,b,c){void 0===c&&(c=.25);var d=1,e=12;!0===this.data.data.buildFloor&&(d=this.data.across,e=this.data.down);var f=(d-1)*game.tileSize,g=(e-1)*game.tileSize,h=!0;if(!1===this.canCommit&&(h=!1),!0===h){var k=new WorldObject(a,b,game.render.newTexture(game.render.tilesets.background,f,g,game.tileSize,game.tileSize));k.data=!0===this.data.data.buildFloor?game.clone(this.data.data):{buildFloor:!0,across:1,down:8},k.x=a,k.y=b,k.across=d,k.down=e,k.alpha=c,k.name="floorholder",console.log("Floor"),game.grid.updateTile(game.gridPos(a),game.gridPos(b),d,e,game.drawLayer),k.destroy()}},b.commitWall=function(b,c){void 0===alpha&&(alpha=.25);var d=this.data.data.across,e=this.data.data.down,f=(d-1)*game.tileSize,g=(e-1)*game.tileSize,h=!0;if(!1===this.canCommit&&(h=!1),h=game.grid.validBuildZone(b,c),h||game.notify("Can't build in this area"),!0===h){var k=new WorldObject(b,c,game.render.newTexture(game.render.tilesets.background,f,g,game.tileSize,game.tileSize));if(k.data=game.clone(this.data.data),this.tempBricks[game.gridPos(b)+"-"+game.gridPos(c)])return!1;this.tempBricks[game.gridPos(b)+"-"+game.gridPos(c)]=!0,k.x=b,k.y=c,k.across=d,k.down=e,k.alpha=alpha,k.name=this.data.data.buildWall?"brickholder":"floorholder";let h=game.grid.getBlockAt(b,c),m=Object.keys(h.items);if(console.log(h),0<m.length)return!1;var l=new BuildItem("icon_build_spot");l.meta.blockZone=a.blockZone||!1,l.data.crafts=a.crafts,l.data.recipe=a.recipe,l.data.complex=a.complex,l.data.across=d,l.data.down=e,l.scaleToGame(),l.x=b,l.y=c,game.world.addObject(l),game.render.objectLayer.addChild(l),l.onCreate(),k.destroy()}},b.mouseDown=!1,b.onMouseDown=function(){b.mouseDown=!0},b.endX=0,b.endY=0,b.lastX=0,b.lastY=0,b.onMouseMove=function(a,b){if(game.rDown||"client"!=game.clientMode){if(this.lastX==a||this.lastY==b)return!1;this.lastX=a,this.lastY=b,this.canCommit=!0;for(var c=0;c<game.tools.activeTool.hoverBricks.length;c++)game.tools.activeTool.hoverBricks[c].destroy&&game.tools.activeTool.hoverBricks[c].destroy();game.tools.activeTool.hoverBricks=[],this.x=a,this.y=b;var d={x:a,y:b};if(startX=game.atGridPos(game.gridPos(game.tools.mouseDownX)),startY=game.atGridPos(game.gridPos(game.tools.mouseDownY)),endX=game.atGridPos(game.gridPos(d.x)),endY=game.atGridPos(game.gridPos(d.y)),"client"==game.clientMode&&(this.startX=game.atGridPos(game.gridPos(game.tools.mouseDownX)),this.startY=game.atGridPos(game.gridPos(game.tools.mouseDownY)),this.endX=game.atGridPos(game.gridPos(d.x)),this.endY=game.atGridPos(game.gridPos(d.y))),"tablet"===game.clientMode&&(!1===this.moverTool||void 0===this.moverTool)&&(sx=24*game.tileSize,sy=9*game.tileSize,staticImage=new WorldObject(a,b,game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)),staticImage.width=32,staticImage.height=32,staticImage.displayGroup=game.render.uiLayer,this.moverTool=staticImage,this.moverTool.isFloor=!0,this.moverTool.startX=a,this.moverTool.startY=b,this.moverTool.endX=0,this.moverTool.endY=0,this.moverTool.interactive=!0,this.moverTool.dragging=!1,this.moverTool.OriginX=0,this.moverTool.OriginY=0,this.moverTool.newX=0,this.moverTool.newY=0,this.moverTool.startDrag=function(a){this.dragging=!0,origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.OriginX=origin.x-this.newX,this.OriginY=origin.y-this.newY,game.render.viewport.pause=!0},this.moverTool.isDragging=function(a){return game.tools.activeTool.onMouseMove(0,0),!!this.dragging&&void(origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.newX=origin.x-this.OriginX,this.newY=origin.y-this.OriginY)},this.moverTool.endDrag=function(){game.render.viewport.pause=!1,this.dragging=!1},this.moverTool.on("pointerdown",this.moverTool.startDrag),this.moverTool.on("pointermove",this.moverTool.isDragging),this.moverTool.on("pointerup",this.moverTool.endDrag),this.moverTool.on("pointerupoutside",this.moverTool.endDrag),staticImage=new UIContainer,img=new WorldObject(a+100,b+100,game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)),staticImage.addChild(img),img.x=32,img.y=32,img.width=32,img.height=32,staticImage.hitArea=new PIXI.Rectangle(32,32,32,32),staticImage.displayGroup=game.render.uiLayer,this.moverTool2=staticImage,this.moverTool2.isFloor=!0,this.moverTool2.startX=startX,this.moverTool2.startY=startY,this.moverTool2.endX=endX,this.moverTool2.endY=endY,this.moverTool2.interactive=!0,this.moverTool2.dragging=!1,this.moverTool2.OriginX=0,this.moverTool2.OriginY=0,this.moverTool2.newX=0,this.moverTool2.newY=0,this.moverTool2.startDrag=function(a){this.dragging=!0,origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.OriginX=origin.x-this.newX,this.OriginY=origin.y-this.newY,game.render.viewport.pause=!0},this.moverTool2.isDragging=function(a){return!!this.dragging&&void(origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),game.atGridPos(game.gridPos(origin.x))>game.tools.activeTool.moverTool.x&&(this.newX=origin.x-this.OriginX),game.atGridPos(game.gridPos(origin.y))>game.tools.activeTool.moverTool.y&&(this.newY=origin.y-this.OriginY))},this.moverTool2.endDrag=function(){game.render.viewport.pause=!1,this.dragging=!1},this.moverTool2.on("pointerdown",this.moverTool2.startDrag),this.moverTool2.on("pointermove",this.moverTool2.isDragging),this.moverTool2.on("pointerup",this.moverTool2.endDrag),this.moverTool2.on("pointerupoutside",this.moverTool2.endDrag),sx=24*game.tileSize,sy=7*game.tileSize,this.moverTool.tickBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)),this.moverTool.tickBtn.width=64,this.moverTool.tickBtn.height=64,this.moverTool.tickBtn.displayGroup=game.render.uiLayer,this.moverTool.tickBtn.interactive=!0,this.moverTool.tickBtn.on("pointerdown",function(){game.tools.activeTool.startX=game.tools.activeTool.moverTool.x,game.tools.activeTool.startY=game.tools.activeTool.moverTool.y,game.tools.activeTool.endX=game.tools.activeTool.moverTool2.x,game.tools.activeTool.endY=game.tools.activeTool.moverTool2.y,game.ui.stageClick(game.tools.activeTool.startX,game.tools.activeTool.startY),game.tools.setActiveTool("select")}),game.render.aboveLife.addChild(this.moverTool.tickBtn),sx=24*game.tileSize,sy=6*game.tileSize,this.moverTool.cancelBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)),this.moverTool.cancelBtn.width=64,this.moverTool.cancelBtn.height=64,this.moverTool.cancelBtn.displayGroup=game.render.uiLayer,this.moverTool.cancelBtn.interactive=!0,this.moverTool.cancelBtn.on("pointerdown",function(){game.tools.setActiveTool("select"),game.tools.closeMenus()}),game.render.aboveLife.addChild(this.moverTool.cancelBtn),game.render.aboveLife.addChild(this.moverTool),game.render.aboveLife.addChild(this.moverTool2)),"tablet"===game.clientMode&&(startX=game.atGridPos(game.gridPos(this.moverTool.x)),startY=game.atGridPos(game.gridPos(this.moverTool.y)),endX=game.atGridPos(game.gridPos(this.moverTool2.x)),endY=game.atGridPos(game.gridPos(this.moverTool2.y)),d={x:this.moverTool2.x,y:this.moverTool2.y}),(0==endX||0==endY||0==startX||0==startY)&&(startX=game.world.centerX,startY=game.world.centerY,endX=game.world.centerX+64,endY=game.world.centerY+64),this.wallHolder(endX,endY),!0===this.mouseDown||"tablet"==game.clientMode){for(endX<startX&&(tmp=endX,endX=startX,startX=tmp),endY<startY&&(tmp=endY,endY=startY,startY=tmp),ABE.infoLog("r:"+startY),xBlocks=(endX-startX)/game.tileSize,yBlocks=(endY-startY)/game.tileSize,xOffset=0,yOffset=0,c=0;c<xBlocks;c++)xOffset+=game.tileSize,this.wallHolder(startX+xOffset,endY+yOffset);if(xOffset=0,yOffset=0,yOffset+=game.tileSize,void 0!==this.data.data.fill)for(c=0;c<yBlocks-1;c++){for(j=0;j<xBlocks-1;j++)xOffset+=game.tileSize,this.wallHolder(startX+xOffset,startY+yOffset);xOffset=0,yOffset+=game.tileSize}for(this.wallHolder(startX,startY),xOffset=0,yOffset=0,this.wallHolder(startX,startY),c=0;c<xBlocks;c++)xOffset+=game.tileSize,this.wallHolder(startX+xOffset,startY);for(yOffset=0,c=0;c<yBlocks;c++)yOffset+=game.tileSize,this.wallHolder(startX+xOffset,startY+yOffset);for(yOffset=0,c=0;c<yBlocks;c++)yOffset+=game.tileSize,this.wallHolder(startX,startY+yOffset)}}},b.onMouseUp=function(a,c){for(var d=0;d<this.hoverBricks.length;d++)this.hoverBricks[d].destroy();if(!0===this.mouseDown||"tablet"===game.clientMode){b.mouseDown=!1;for(startX=this.startX,strtY=this.startY,endX=this.endX,endY=this.endY,endX<startX&&(tmp=endX,endX=startX,startX=tmp),endY<startY&&(tmp=endY,endY=startY,startY=tmp),ABE.infoLog("r:"+startY),xBlocks=(endX-startX)/game.tileSize,yBlocks=(endY-startY)/game.tileSize,xOffset=0,yOffset=0,alpha=this.data.data.alpha,void 0===alpha&&(alpha=.25),d=0;d<xBlocks;d++)xOffset+=game.tileSize,!0===this.data.data.buildFloor?this.commitFloor(startX+xOffset,endY+yOffset,alpha):this.commitWall(startX+xOffset,endY+yOffset,alpha);for(!0===this.data.data.buildFloor?this.commitFloor(startX,startY,alpha):this.commitWall(startX,startY,alpha),xOffset=0,yOffset=0,d=0;d<xBlocks;d++)xOffset+=game.tileSize,!0===this.data.data.buildFloor?this.commitFloor(startX+xOffset,startY,alpha):this.commitWall(startX+xOffset,startY,alpha);for(yOffset=0,d=0;d<yBlocks-1;d++)yOffset+=game.tileSize,!0===this.data.data.buildFloor?this.commitFloor(startX+xOffset,startY+yOffset,alpha):this.commitWall(startX+xOffset,startY+yOffset,alpha);for(yOffset=0,d=0;d<yBlocks;d++)yOffset+=game.tileSize,!0===this.data.data.buildFloor?this.commitFloor(startX,startY+yOffset,alpha):this.commitWall(startX,startY+yOffset,alpha);if(xOffset=0,yOffset=0,yOffset+=game.tileSize,void 0!==this.data.data.fill)for(d=0;d<yBlocks-1;d++){for(j=0;j<xBlocks-1;j++)xOffset+=game.tileSize,this.data.data.fill?this.fill(startX+xOffset,startY+yOffset,alpha,this.data.data.fill):this.commitWall(startX+xOffset,startY+yOffset,alpha);xOffset=0,yOffset+=game.tileSize}setTimeout(()=>{game.grid.drawWalls()},2e3)}},b.deactivate=function(){game.clientMode="tablet";for(var a=0;a<this.hoverBricks.length;a++)this.hoverBricks[a].destroy();this.moverTool!==void 0&&this.moverTool.destroy!==void 0&&(this.moverTool.tickBtn.destroy(),this.moverTool.cancelBtn.destroy(),this.moverTool.destroy(),this.moverTool2.destroy())},this.activeTool=b}});