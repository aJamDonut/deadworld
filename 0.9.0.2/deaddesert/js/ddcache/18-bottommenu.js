var tool=function(){game.ui.pinnedTool=!1,game.ui.bottomPage=1,game.ui.resetPage=!1;var a=function(a){var b=[];if("survival"==this.name){let a=game.session.getUnlockedRecipes("build");for(let c=0;c<a.length;c++){let d=game.session.getRecipe(a[c]),e=!!game.itemTable.worldItems[d.crafts];b.push({name:a[c],readName:d.name,description:d.description||"",recipe:a[c],crafts:d.crafts,complex:e,sprite:d.sprite,toolName:"godfurni"})}console.log("TOOLS",b)}else for(let a=0;a<this.toolContents.length;a++)b.push(this.toolContents[a]);try{if(console.error("acti P:"+a),this.name!==game.ui.activeToolName&&(game.ui.bottomPage=1),game.ui.activeToolName=this.name,game.tools.deactivate(a),void 0!==this.tutNumbers)for(var c=0;c<this.tutNumbers.length&&!game.tut(this.tutNumbers[c]);c++);var d=!1;0==b.length&&(d=!0);var e,f,g,j,k,l,m,n;n=function(){game.ui.clicked=!0,game.ui.showItemInfo(this.tool),menu=this.tool.submenu,menuData=game.world.objectTemplates[menu],!0===game.settings.locked[menu]?(game.ui.clicked=!0,game.ui.notification(_LANG.MUST_UNLOCK_TOOL)):(game.tools.activeMenu=menu,game.ui.clicked=!0,game.tools.setActiveTool(menu))},e=function(){game.ui.clicked=!0,game.ui.showItemInfo(this.tool),console.error("CLICKY LA34",this.tool.toolName,this),"godfurni"==this.tool.toolName?game.tools.setGodFurniTool(this.tool):game.tools.setFurniTool(this.tool)},f=function(){game.ui.clicked=!0,game.tools.setStaffTool(this.tool),console.error("CLICKY LA4"),game.ui.showItemInfo(this.tool)},g=function(){game.ui.clicked=!0,game.ui.showItemInfo(this.tool),console.error("CLICKY LA3"),"playerSquaring"==this.tool.toolName?(game.tools.setPlayerSquaringTool(this.tool),console.error("Player squaring")):(game.tools.setSquaringTool(this.tool),console.error("Squaring"))},j=function(){game.ui.clicked=!0,game.ui.showItemInfo(this.tool),"playerSquaring"==this.tool.toolName?(game.tools.setPlayerSquaringTool(this.tool),console.error("Player squaring")):(game.tools.setSquaringTool(this.tool),console.error("Squaring",this,this.tool))},k=function(){game.ui.clicked=!0,console.error("CLICKY LA",this.tool),game.ui.showItemInfo(this.tool),"playersquaring"==this.toolName&&(game.tools.setPlayerSquaringTool(this.tool),console.error("Player squaring")),"playercancel"==this.toolName&&game.tools.setPlayerCancelTool(this.tool),"playerdestroy"==this.toolName&&game.tools.setPlayerDestroyTool(this.tool),"playerfurni"==this.toolName&&game.tools.setPlayerFurniTool(this.tool)},l=function(){game.ui.clicked=!0,!0!==game.settings.locked.upgrades||1?(game.ui.upgradesPage=1,console.error(this),"machines"==game.ui.activeToolName||"tables"==game.ui.activeToolName?game.ui.showUpgradeMenu(game.upgradeUIOptions.suppliers):game.ui.showUpgradeMenu(game.upgradeUIOptions.research)):game.ui.notification("You must unlock this item first")},m=function(){game.ui.showItemInfo(this.tool)},0<game.tools.menuButtons.length&&game.tools.closeMenus();var o=0,p=0;!0===this.rotate&&(o=600>game.ui._VIEWPORT_BOTTOM?350:270,p=game.ui._VIEWPORT_BOTTOM-260,sx=17*game.tileSize,sy=3*game.tileSize,staticImage=new WorldObject(o,p,game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)),staticImage.x=o+46,staticImage.y=p,staticImage.width=64,staticImage.height=64,staticImage.displayGroup=game.render.uiLayer,game.render.baseStage.addChild(staticImage),staticImage.readName=_LANG.ROTATE,staticImage.interactive=!0,game.attachCursorEvents(staticImage),staticImage.on("pointerdown",function(){game.ui.clicked=!0,3<=game.tools.direction?game.tools.direction=0:game.tools.direction++}),staticImage.on("pointerover",function(){console.error("IN")}),staticImage.on("pointerout",function(){console.error("OUT")}),game.tools.menuButtons.push(staticImage)),"tablet"==game.clientMode&&(o=600>game.ui._VIEWPORT_BOTTOM?10:10,p=game.ui._VIEWPORT_BOTTOM-680,sx=!0===game.ui.pinnedTool?24*game.tileSize:23*game.tileSize,sy=3*game.tileSize,staticImage=new WorldObject(o,p,game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)),staticImage.clickFunction=function(){game.ui.pinnedTool=!game.ui.pinnedTool,sy=3*game.tileSize,void 0!==game.tools.activeTool.moverTool&&(game.ui.pinnedTool?(void 0===game.tools.activeTool.moverTool2?(game.tools.activeTool.moverTool.newX=0,game.tools.activeTool.moverTool.newY=0):(game.tools.activeTool.moverTool.newX=0,game.tools.activeTool.moverTool.newY=0),o=game.atGridPos(game.gridPos(game.render.viewport.left+game.render.viewport.worldScreenWidth/2)),p=game.atGridPos(game.gridPos(game.render.viewport.top+game.render.viewport.worldScreenHeight/2))):(game.ui.tempUnpin=!1,void 0===game.tools.activeTool.moverTool2?void 0!==game.tools.activeTool.furni&&(game.tools.activeTool.moverTool.newX=game.atGridPos(game.gridPos(game.tools.activeTool.furni.x)),game.tools.activeTool.moverTool.newY=game.atGridPos(game.gridPos(game.tools.activeTool.furni.y))):(game.tools.activeTool.moverTool.newX=game.tools.activeTool.moverTool.x,game.tools.activeTool.moverTool.newY=game.tools.activeTool.moverTool.y))),game.ui.pinnedTool?(sx=24*game.tileSize,this.texture=game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64)):(sx=23*game.tileSize,this.texture=game.render.newTexture(game.render.tilesets.gui,sx,sy,64,64))},game.ui.pinningTool=staticImage,game.ui.pinningTool.reset=function(){game.ui.pinningTool.clickFunction()},staticImage.x=o+46+64+10,staticImage.y=p,staticImage.width=64,staticImage.height=64,staticImage.displayGroup=game.render.uiLayer,game.render.baseStage.addChild(staticImage),staticImage.readName=_LANG.ROTATE,staticImage.interactive=!0,game.attachCursorEvents(staticImage),staticImage.on("pointerdown",staticImage.clickFunction),staticImage.on("pointerover",function(){console.error("Over this one 2")}),game.tools.menuButtons.push(staticImage)),o=game.ui._PADDING_SMALL,p=game.ui._VIEWPORT_BOTTOM-64-game.ui._PADDING_SMALL-game.ui._PADDING_SMALL;var q=550,h=function(){game.tools.setActiveTool("select"),game.tools.closeMenus()};closeX=600,closeY=p-q-32,this.window=game.render.component("drawBoxPane",{x:0,y:0,w:600,h:q}),this.window.y=game.bmMenu.y-q,game.render.baseStage.addChild(this.window),ABE.infoLog("Boostrap tools UI"),o+=game.ui._PADDING_SMALL+game.ui._PADDING_SMALL+game.ui._PADDING_SMALL,p=p-q-40;var r=30,s=game.ui.bottomPage*r,u=game.ui.bottomPage*r-r;s>b.length&&(s=b.length),alpha=1<game.ui.bottomPage&&!1===d?1:0,sx=19*game.tileSize,sy=5*game.tileSize,upArrow=new WorldObject(o,p,game.render.newTexture(game.render.tilesets.gui,sx,sy,32,32)),upArrow.alpha=alpha,upArrow.width=32,upArrow.height=32,upArrow.displayGroup=game.render.uiLayer,game.render.aboveAll.addChild(upArrow),upArrow.tool=this,upArrow.x=570,upArrow.y=game.ui._VIEWPORT_BOTTOM-167,upArrow.interactive=!0,game.attachCursorEvents(upArrow),game.tools.menuButtons.push(upArrow),upArrow.displayGroup=game.render.uiLayer,game.render.aboveAll.addChild(upArrow),alpha&&upArrow.on("pointerdown",function(){game.ui.clicked=!0,game.ui.bottomPage--,this.tool.activated(game.ui.bottomPage)}),alpha=u+r<b.length&&!1===d?1:0,sx=20*game.tileSize,sy=5*game.tileSize,downArrow=new WorldObject(o,p,game.render.newTexture(game.render.tilesets.gui,sx,sy,32,32)),downArrow.alpha=alpha,downArrow.width=32,downArrow.height=32,downArrow.displayGroup=game.render.uiLayer,game.render.aboveAll.addChild(downArrow),downArrow.tool=this,downArrow.x=570,downArrow.y=game.ui._VIEWPORT_BOTTOM-130,downArrow.interactive=!0,game.attachCursorEvents(downArrow),game.tools.menuButtons.push(downArrow),downArrow.displayGroup=game.render.uiLayer,game.render.aboveAll.addChild(downArrow),1==alpha&&downArrow.on("pointerdown",function(){game.ui.clicked=!0,game.ui.bottomPage++,console.error(this.tool),console.error(game.tools.activeTool),game.tools.activeTool.name!==this.tool.name&&game.tools.activeTool.deactivate(),game.tools.setActiveTool(this.tool.name)});o=35;var v=64,w=64;p-=50;for(var z=u;z<s;z++){switch(0==z%6&&(o=35,p+=100),b[z].blocks){case 1:v=64,w=64,sx=(b[z].across-1)*v,sy=(b[z].down-1)*game.lifeTileSize;break;case 2:v=64,w=128,sx=(b[z].across-1)*v,sy=(b[z].down-1)*game.lifeTileSize;break;case 3:v=192,w=192,sx=64*(b[z].across-1),sy=64*(b[z].down-1);break;case 4:v=64,w=128,sx=(b[z].across-1)*v,sy=(b[z].down-1)*game.lifeTileSize;break;case 5:v=128,w=128,sx=64*(b[z].across-1),sy=(b[z].down-1)*game.lifeTileSize;break;case 6:v=384,w=320,sx=64*(b[z].across-1),sy=(b[z].down-1)*game.lifeTileSize;}containerWindow=game.render.window(o-7.5,p+7.5,64,64);let a=b[z].type?b[z].type:this.name;if("furni"===a?furniView=new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.furni,sx,sy,v,w)):"walls"===a?furniView="floor"==b[z].codename?new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.background,sx,sy,v,w)):new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.furni,sx,sy,v,w)):"fills"===a?furniView="floor"==b[z].codename?new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.background,sx,sy,v,w)):new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.furni,sx,sy,v,w)):"floors"===a?furniView=new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.background,sx,sy,v,w)):"staff"===a?(sx=b[z].across*v,furniView=new WorldObject(o,p+15,game.render.newTexture(game.render.tilesets.skins,sx,sy,v,w)),furniView.x+=0):void 0,"fills"!==this.name&&"walls"!==this.name&&b[z].sprite)try{furniView=new VanillaItem("menughost",b[z].sprite)}catch(a){console.log(b[z]),console.error("Failed to load: "+b[z].sprite.codename)}if(b[z].recipe)furniView=game.render.componentRaw("component_blueprint",{name:b[z].crafts,recipe:game.session.getRecipe(b[z].recipe)}),furniView.scale.x=.75,furniView.scale.y=.75,furniView.x=o-7,furniView.y=p+15;else{let a=32/100,b=0;b=furniView.width>furniView.height?1/(furniView.width/a/100):1/(furniView.height/a/100),furniView.scale.x=b,furniView.scale.y=b,furniView.x=o+10,furniView.y=p+25}furniView.displayGroup=game.render.uiLayer,game.render.baseStage.addChild(containerWindow),furniView.tool=b[z],furniView.displayGroup=game.render.uiLayer,game.render.baseStage.addChild(furniView);let c=new Sprite("save_icon");c.isInteractive(),c.width=64,c.height=64,c.tool=b[z],c.alpha=0,c.toolName=b[z],c.x=furniView.x-16,c.y=furniView.y-16,game.attachCursorEvents(c),game.render.aboveAll.addChild(c);var A;if(game.isLocked(b[z].codename))furniView.alpha=.5,A=game.render.text(b[z].readName,"small-item-title-disabled",game.render.baseStage),c.on("pointerdown",l);else{let a=b[z].readName||"noname";if(13<a.length&&(a=a.substring(0,10)+"..."),A=game.render.text(a,"small-item-title",game.render.baseStage),void 0!==b[z].submenu)c.on("pointerdown",n);else switch(this.name){case"furni":c.on("pointerdown",e);break;case"staff":c.on("pointerdown",f);break;case"floors":c.on("pointerdown",g);break;case"walls":c.on("pointerdown",j);break;case"fills":c.on("pointerdown",j);break;case"planning":c.toolName=b[z].toolName,c.on("pointerdown",k);break;default:c.on("pointerdown",e);}}if(c.on("pointerdown",function(){game.tools.closeMenus()}),c.on("pointerover",function(){let a=this.tool,b=a.recipe,c=a.crafts;console.error("Over",this)}),c.on("pointerout",function(){console.error("Out",this)}),A.x=o-10,A.y=p-2.5,b[z].recipe){let a=new ComplexItem(b[z].crafts);a.readName=b[z].readName,a.meta.description=b[z].description,game.inventories.attachHoverFunctions(c,a,!0)}game.tools.menuButtons.push(A),game.tools.menuButtons.push(furniView),game.tools.menuButtons.push(c),game.tools.menuButtons.push(containerWindow),o+=96}game.tools.menuWindows.push(this.window),!1===d&&game.tools.menuButtons.push(game.ui.closeButton(closeX,closeY,h)),game.ui.showItemInfo(this),0==b.length&&(this.window.alpha=0,game.ui.pinningTool.alpha=0)}catch(a){console.error(a)}};var b=function(a){!0===game.ui.resetPage&&(game.ui.bottomPage=1),console.error("p:"+a)};for(var c=game.ui.data.menus,d=0;d<c.length;d++){var e=c[d].name,f=c[d].tools,g=new Tool(e);g.hoverBricks=[],g.toolContents=f,g.window={},g.buttons=[],g.readName=c[d].readName,g.tutNumbers=c[d].tutNumbers,g.description=c[d].description,g.rotate=c[d].rotate||!1,g.activated=a,g.deactivate=b,game.tools.addTool(g)}};bootStrap.push(tool);