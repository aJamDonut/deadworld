bootStrap.push(function(){function a(a,b){game.grid.updateTileMeta(a,b,{zone:game.activeDrawZone})}function b(b){let c=Object.keys(b);if(c.length)for(let d of c){let c=b[d];c&&c.position&&a(game.gridPos(c.x),game.gridPos(c.y))}}function c(a,b,e,f,g){const h={},k=64;if("godfurni"===game.tools.activeTool.data.toolName&&(b=f,e=g),f<b)return c(a,f,e,b,g);if(g<e)return c(a,b,g,f,e);for(let c=b;c<=f;c+=k)for(let i=e;i<=g;i+=k)!game.fillMode&&b<c&&c<f&&e<i&&i<g||(a[c+"-"+i]&&(h[c+"-"+i]=a[c+"-"+i]),h[c+"-"+i]||(h[c+"-"+i]=d(c,i)));return i(a,h),h}function d(a,b){const c=game.tools.activeTool.data.sprite?game.tools.activeTool.data.sprite:"icon_build_spot",d=new SimpleItem(c);d.scaleToGame(),d.alpha=1,d.x=a,d.y=b;let e=game.render.text(game.activeDrawZone);return d.text=e,d.addChild(e),game.render.objectLayer.addChild(d),d}function e(a,b){const c=game.tools.activeTool;console.log("Tool",c);let d=game.tools.activeTool.data.sprite?game.tools.activeTool.data.sprite:"icon_build_spot";d=game.tools.activeTool.data.buildItemSprite?game.tools.activeTool.data.buildItemSprite:d;var e=new BuildItem(d);e.meta.blockZone=c.blockZone||!1,e.data.crafts=c.data.crafts||!1,e.data.recipe=c.data.recipe||!1,e.data.complex=c.data.complex||!1,e.data.across=c.data.across||4,e.data.down=c.data.down||4,e.data.tint=c.data.tint||game.activeTint||!1,e.scaleToGame(),e.x=game.atGridPos(a),e.y=game.atGridPos(b),game.world.addObject(e),game.render.objectLayer.addChild(e),e.onCreate(),c.data.cancel&&e.destroy()}function f(a,b,c){c?(console.log("no comit"),e(a,b)):(console.log("comit"),game.tools.activeTool.data.tint=game.activeTint||!1,game.grid.updateTile(a,b,game.tools.activeTool.data.across,game.tools.activeTool.data.down,game.drawLayer,!0,game.tools.activeTool.data.tint))}function g(a,b){let c=Object.keys(a);if(c.length){for(let d of c){let c=a[d];c&&c.position&&f(game.gridPos(c.x),game.gridPos(c.y),b)}game.grid.resolveWalls()}}function h(a,b){console.log("Furni at",a,b);const c=game.tools.activeTool.data.sprite?game.tools.activeTool.data.sprite:"icon_build_spot",d=new SimpleItem(c);return d.scaleToGame(),d.alpha=1,d.x=a,d.y=b,game.render.objectLayer.addChild(d),d}function i(a,b){let c=Object.keys(a);for(let d of c)b[d]||(console.log("Doesnt exist, destroy"),a[d].destroy(),delete a[d])}function j(a,b,c,d,e){const f={},g=64;if("godfurni"===game.tools.activeTool.data.toolName&&(b=d,c=e),d<b)return j(a,d,c,b,e);if(e<c)return j(a,b,e,d,c);for(let k=b;k<=d;k+=g)for(let i=c;i<=e;i+=g)!game.fillMode&&b<k&&k<d&&c<i&&i<e||(a[k+"-"+i]&&(f[k+"-"+i]=a[k+"-"+i]),f[k+"-"+i]||(f[k+"-"+i]=h(k,i)));return i(a,f),f}game.activeDrawZone=0,game.tools.buildZone=function(a){game.tools.deactivate();const e=new Tool(a.name);e.createFurni=!0,e.data=a,e.canCommit=game.editMode,e.moverTool=!1,e.walls={},this.activeTool=e,e.holder=d(0,0),e.toolMode="fill",e.onMouseDown=function(){game.levelEditorButtonMode="square",game.buildTools.stopCircle(),game.circleMode=!1,game.fillMode=!0,game.toolMode="square",this.startX=game.mouseX,this.startY=game.mouseY,this.holder.isDown=!0},e.onMouseMove=function(){return this.holder.text.text=game.activeDrawZone,this.holder.x=game.snapToGrid(game.mouseX),this.holder.y=game.snapToGrid(game.mouseY),!!(this.startX&&this.startY)&&void(this.walls=c(this.walls,game.snapToGrid(this.startX),game.snapToGrid(this.startY),game.snapToGrid(game.mouseX),game.snapToGrid(game.mouseY)))},e.onMouseUp=function(){this.startX=0,this.startY=0,this.holder.isDown=!1,b(this.walls),i(this.walls,{})},e.deactivate=function(){this.holder.destroy()}},game.tools.newBuildWallTool=function(a){game.tools.deactivate();const b=new Tool(a.name);b.createFurni=!0,b.data=a,b.canCommit=game.editMode,b.moverTool=!1,b.startX=0,b.data.tint=game.activeTint||!1,b.tint=game.activeTint||!1,b.startY=0,b.walls={},this.activeTool=b,b.holder=h(0,0),b.toolMode="fill",console.log("TOOL",a),a.data&&a.data.layer&&(game.drawLayer=a.data.layer),b.onMouseDown=function(){this.startX=game.mouseX,this.startY=game.mouseY,this.holder.alpha=0},b.onMouseMove=function(){var a=Math.abs;if(this.holder.x=game.snapToGrid(game.mouseX),this.holder.y=game.snapToGrid(game.mouseY),!this.startX||!this.startY)return!1;if("line"===game.toolMode){let b=a(game.mouseX-this.startX),c=a(game.mouseY-this.startY);this.walls=b>c?j(this.walls,game.snapToGrid(this.startX),game.snapToGrid(this.startY),game.snapToGrid(game.mouseX),game.snapToGrid(this.startY)):j(this.walls,game.snapToGrid(this.startX),game.snapToGrid(this.startY),game.snapToGrid(this.startX),game.snapToGrid(game.mouseY))}else this.walls=j(this.walls,game.snapToGrid(this.startX),game.snapToGrid(this.startY),game.snapToGrid(game.mouseX),game.snapToGrid(game.mouseY))},b.onMouseUp=function(){this.holder.alpha=1,this.lastsweep=!1,g(this.walls,!game.editMode),this.startX=0,this.startY=0,i(this.walls,{})},b.deactivate=function(){this.startX=0,this.startY=0,this.holder.destroy(),i(this.walls,{})}}}),bootStrap.push(function(){game.tools.setGodFurniTool=function(a){game.tools.lastsweep=!1,game.ui.pinnedTool=!1,game.ui.pinningTool.reset(),ABE.infoLog(a.name),game.cursorHide(),game.tools.deactivate();var b=new Tool(a.name);b.createFurni=!0,b.data=a,b.canCommit=game.editMode,a.data.canColor||(game.activeTint=!1),b.onMouseDown=function(b,c){if(this.canCommit=game.grid.validBuildZone(b,c),!this.canCommit)return void game.notify(t("notifications.cannot_build_in_area"));var d=new BuildItem(a.sprite);d.data.crafts=a.crafts,d.data.recipe=a.recipe,d.data.complex=a.complex,d.scaleToGame(),d.x=b,d.y=c,game.world.addObject(d),game.render.objectLayer.addChild(d),d.onCreate(),3>game.session.getDay()&&game.session.setAllCommand("jobs"),this.lastsweep=!1,this.onMouseMove(b,c)},b.moverTool=!1,b.onMouseMove=function(a,b){game.snap=!0;var c=0;c=1==this.data.blocks?this.data.across+game.tools.direction:this.data.across;var d=this.data.down,e=(c-1)*game.tileSize,f=(d-1)*game.tileSize,g=game.tileSize,j=game.tileSize;if(!0==game.snap&&(a=game.atGridPos(game.gridPos(a)),b=4==this.data.blocks?game.atGridPos(game.gridPos(b-64)):game.atGridPos(game.gridPos(b))),!0===this.createFurni&&(this.standArea={},this.standArea2={},this.standArea3={},this.standArea4={},a=game.atGridPos(game.gridPos(game.render.viewport.left+game.render.viewport.worldScreenWidth/2)),b=game.atGridPos(game.gridPos(game.render.viewport.top+game.render.viewport.worldScreenHeight/2)),this.furni=new SimpleItem(this.data.sprite),this.furni.scaleToGame(),game.ui.tempUnpin=!0,"tablet"===game.clientMode&&(!1===this.moverTool||void 0===this.moverTool)&&(e=24*game.tileSize,f=9*game.tileSize,staticImage=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,g,j)),staticImage.width=g,staticImage.height=j,this.moverTool=staticImage,this.moverTool.interactive=!0,this.dragging=!1,this.moverTool.OriginX=0,this.moverTool.OriginY=0,this.moverTool.newX=0,this.moverTool.newY=0,this.moverTool.startDrag=function(a){this.dragging=!0,origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.OriginX=origin.x-this.newX,this.OriginY=origin.y-this.newY,game.render.viewport.pause=!0,game.ui.tempUnpin=!0},this.moverTool.isDragging=function(a){return!!this.dragging&&void(origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.newX=origin.x-this.OriginX,this.newY=origin.y-this.OriginY)},this.moverTool.endDrag=function(){game.ui.tempUnpin=!1,game.render.viewport.pause=!1,this.dragging=!1},this.moverTool.on("pointerdown",this.moverTool.startDrag),this.moverTool.on("pointermove",this.moverTool.isDragging),this.moverTool.on("pointerup",this.moverTool.endDrag),this.moverTool.on("pointerupoutside",this.moverTool.endDrag),e=24*game.tileSize,f=7*game.tileSize,this.moverTool.tickBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,64,64)),this.moverTool.tickBtn.width=64,this.moverTool.tickBtn.height=64,this.moverTool.tickBtn.interactive=!0,this.moverTool.tickBtn.on("pointerdown",function(){game.ui.clicked=!0,game.ui.stageClick(game.tools.activeTool.furni.x,game.tools.activeTool.furni.y)}),game.render.aboveLife.addChild(this.moverTool.tickBtn),e=24*game.tileSize,f=6*game.tileSize,this.moverTool.cancelBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,64,64)),this.moverTool.cancelBtn.width=64,this.moverTool.cancelBtn.height=64,this.moverTool.cancelBtn.displayGroup=game.render.uiLayer,this.moverTool.cancelBtn.interactive=!0,this.moverTool.cancelBtn.on("pointerdown",function(){game.ui.clicked=!0,game.tools.setActiveTool("select"),game.tools.closeMenus()}),e=24*game.tileSize,f=10*game.tileSize,1==this.data.dirs?this.moverTool.rotateBtn=!1:(this.moverTool.rotateBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,64,64)),this.moverTool.rotateBtn.width=64,this.moverTool.rotateBtn.height=64,this.moverTool.rotateBtn.displayGroup=game.render.uiLayer,this.moverTool.rotateBtn.interactive=!0,this.moverTool.rotateBtn.on("pointerdown",function(){game.ui.clicked=!0,3<=game.tools.direction?game.tools.direction=0:game.tools.direction++}),game.render.objectLayer.addChild(this.moverTool.rotateBtn)),game.render.aboveLife.addChild(this.moverTool.cancelBtn),this.moverTool.alpha=.15,game.render.aboveLife.addChild(this.moverTool)),this.furni.alpha=1,game.render.objectLayer.addChild(this.furni),this.createFurni=!1,void 0!==this.data&&null!=this.data.data&&(!0===this.data.data.standArea&&(this.standArea=game.standArea(),game.render.objectLayer.addChild(this.standArea)),!0===this.data.data.standArea2&&(this.standArea2=game.standArea(),game.render.objectLayer.addChild(this.standArea2)),!0===this.data.data.standArea3&&(this.standArea3=game.standArea(),game.render.objectLayer.addChild(this.standArea3)),!0===this.data.data.standArea4&&(this.standArea4=game.standArea(),game.render.objectLayer.addChild(this.standArea4)))),void 0===this.data)this.data={};else if(null==this.data.data)this.data.data={};else if(!0===this.data.data.standArea)switch(game.tools.direction){case 0:this.standArea.x=a,this.standArea.y=b+game.tileSize;break;case 1:this.standArea.x=a,this.standArea.y=b-game.tileSize;break;case 2:this.standArea.x=a+game.tileSize,this.standArea.y=b;break;case 3:this.standArea.x=a-game.tileSize,this.standArea.y=b;}if(!0===this.data.data.standArea2)switch(game.tools.direction){case 0:this.standArea2.x=a,this.standArea2.y=b-game.tileSize;break;case 1:this.standArea2.x=a,this.standArea2.y=b+game.tileSize;break;case 2:this.standArea2.x=a-game.tileSize,this.standArea2.y=b;break;case 3:this.standArea2.x=a+game.tileSize,this.standArea2.y=b;}if(!0===this.data.data.standArea3)switch(game.tools.direction){case 0:this.standArea3.x=a,this.standArea3.y=b;break;case 1:this.standArea3.x=a+game.tileSize,this.standArea3.y=b;break;case 2:this.standArea3.x=a,this.standArea3.y=b-16;break;case 3:this.standArea3.x=a,this.standArea3.y=b+game.tileSize;}if(!0===this.data.data.standArea4)switch(game.tools.direction){case 0:this.standArea4.x=a+game.tileSize,this.standArea4.y=b+game.tileSize;break;case 1:this.standArea4.x=a,this.standArea4.y=b-game.tileSize;break;case 2:this.standArea4.x=a-game.tileSize,this.standArea4.y=b+game.tileSize;break;case 3:this.standArea4.x=a,this.standArea4.y=b+game.tileSize+game.tileSize;}if(this.lastsweep&&(this.furni.tint=16711680),2==this.data.blocks)switch(game.tools.direction){case 0:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize,f+game.tileSize,128,game.tileSize),this.furni.height=game.tileSize,this.furni.width=128;break;case 1:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize,f,128,game.tileSize),this.furni.height=game.tileSize,this.furni.width=128;break;case 2:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize+game.tileSize+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 3:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;}if(3==this.data.blocks&&(this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+1,f,4*game.tileSize,4*game.tileSize),this.furni.height=4*game.tileSize,this.furni.width=4*game.tileSize),5==this.data.blocks&&(this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,2*game.tileSize,2*game.tileSize),this.furni.height=2*game.tileSize,this.furni.width=2*game.tileSize),6==this.data.blocks&&(this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,6*game.tileSize,5*game.tileSize),this.furni.height=5*game.tileSize,this.furni.width=6*game.tileSize),4==this.data.blocks)switch(game.tools.direction){case 0:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 1:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 2:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize+game.tileSize+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 3:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;}if(this.furni.x=void 0===this.data.offsetX?a:a-this.data.offsetX,this.furni.y=void 0===this.data.offsetY?b:b-this.data.offsetY,0==game.world.objects.length&&(this.lastsweep=!0),this.furni.tint=this.lastsweep?16777215:16711680,0<game.world.objects.length){checkIncrementer=50,(isNaN(this.collisionCheckId)||null==this.collisionCheckId||0==this.collisionCheckId)&&(this.fullsweep=!1,this.collisionCheckId=0);var h=this.collisionCheckId,k=this.collisionCheckId+checkIncrementer;k>game.world.objects.length?(this.collisionCheckId=0,k-=k-game.world.objects.length):this.collisionCheckId=k,ABE.infoLog("Last sweep: "+this.lastsweep+"check world objects Start: "+h+"End: "+k);for(var l=h;l<k;l++)if(void 0!==game.world.objects[l]&&"trash"!=game.world.objects[l].name){if(game.world.objects[l].tint=16777215,!0===game.world.objects[l].data.buildFloor&&"brickholder"!=game.world.objects[l].name){ABE.infoLog("brickholder 1");continue}if("allowwall"==this.data.collide&&"brickholder"==game.world.objects[l].name){ABE.infoLog("brickholder 2");continue}if(game.world.rCollision(this.furni,game.world.objects[l])||game.world.rCollision(this.standArea,game.world.objects[l]))return this.fullsweep=!1,game.world.objects[l].tint=16711680,this.furni.tint=16711680,this.collisionCheckId=0,this.canCommit=!1,!1}k>=game.world.objects.length&&(this.fullsweep=!0,this.lastsweep=this.fullsweep,this.canCommit=!0)}},game.ui.tempUnpin=!1,b.deactivate=function(){for(var a=0;a<game.world.objects.length;a++)void 0!==game.world.objects[a]&&void 0!==game.world.objects[a].tint&&(game.world.objects[a].tint=16777215);this.furni!==void 0&&this.furni.destroy(),this.moverTool!==void 0&&this.moverTool.destroy!==void 0&&(this.moverTool.tickBtn.destroy(),this.moverTool.cancelBtn.destroy(),!1!==this.moverTool.rotateBtn&&this.moverTool.rotateBtn.destroy(),this.moverTool.destroy()),this.createFurni=!0,!0===this.data.data.standArea&&this.standArea!==void 0&&(this.standArea.destroy(),game.world.removeObject(this.standArea.id)),!0===this.data.data.standArea2&&this.standArea2!==void 0&&(this.standArea2.destroy(),game.world.removeObject(this.standArea2.id)),!0===this.data.data.standArea3&&this.standArea!==void 0&&(this.standArea3.destroy(),game.world.removeObject(this.standArea3.id)),!0===this.data.data.standArea4&&this.standArea4!==void 0&&(this.standArea4.destroy(),game.world.removeObject(this.standArea4.id))},b.onMouseUp=function(){this.lastsweep=!1},this.activeTool=b}});