bootStrap.push(function(){game.tools.setPlayerFurniTool=function(a,b,c,d){game.tools.lastsweep=!1,game.ui.pinnedTool=!1,ABE.infoLog(a.name),game.cursorHide(),game.tools.deactivate();var e=new Tool(a.name);e.callback=b,e.type="playerfurni",e.caller=d,e.callbackData=c,e.createFurni=!0,e.data=a,e.canCommit=game.editMode,e.onMouseDown=function(a,b){var c=new PickupItem(this.data.codename,this.data.data);c.setScale(.5),c.rotate(Math.random()),c.x=a,c.y=b,game.world.addObject(c),game.render.lifeLayer.addChild(c),this.lastsweep=!1,this.onMouseMove(a,b),this.callback(this.callbackData)},e.moverTool=!1,e.onMouseMove=function(a,b){var c=0;c=1==this.data.blocks?this.data.across+game.tools.direction:this.data.across;var d=this.data.down,e=(c-1)*game.tileSize,f=(d-1)*game.tileSize,g=game.tileSize,j=game.tileSize;if(!0==game.snap&&(a=game.atGridPos(game.gridPos(a)),b=4==this.data.blocks?game.atGridPos(game.gridPos(b-64)):game.atGridPos(game.gridPos(b))),!0===this.createFurni&&(this.standArea={},this.standArea2={},this.standArea3={},this.standArea4={},this.furni=new PickupItem(this.data.codename,this.data.data),this.furni.scaleToGame(),game.ui.tempUnpin=!0,"tablet"===game.clientMode&&(!1===this.moverTool||void 0===this.moverTool)&&(e=24*game.tileSize,f=9*game.tileSize,staticImage=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,g,j)),staticImage.width=g,staticImage.height=j,this.moverTool=staticImage,this.moverTool.interactive=!0,this.dragging=!1,this.moverTool.OriginX=0,this.moverTool.OriginY=0,this.moverTool.newX=0,this.moverTool.newY=0,this.moverTool.startDrag=function(a){this.dragging=!0,origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.OriginX=origin.x-this.newX,this.OriginY=origin.y-this.newY,game.render.viewport.pause=!0,game.ui.tempUnpin=!0},this.moverTool.isDragging=function(a){return!!this.dragging&&void(origin=game.render.viewport.toWorld(a.data.global.x,a.data.global.y),this.newX=origin.x-this.OriginX,this.newY=origin.y-this.OriginY)},this.moverTool.endDrag=function(){game.ui.tempUnpin=!1,game.render.viewport.pause=!1,this.dragging=!1},this.moverTool.on("pointerdown",this.moverTool.startDrag),this.moverTool.on("pointermove",this.moverTool.isDragging),this.moverTool.on("pointerup",this.moverTool.endDrag),this.moverTool.on("pointerupoutside",this.moverTool.endDrag),e=24*game.tileSize,f=7*game.tileSize,this.moverTool.tickBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,64,64)),this.moverTool.tickBtn.width=32,this.moverTool.tickBtn.height=32,this.moverTool.tickBtn.interactive=!0,this.moverTool.tickBtn.on("pointerdown",function(){game.ui.clicked=!0,game.ui.stageClick(game.tools.activeTool.furni.x,game.tools.activeTool.furni.y)}),game.render.world.addChild(this.moverTool.tickBtn),e=24*game.tileSize,f=6*game.tileSize,this.moverTool.cancelBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,64,64)),this.moverTool.cancelBtn.width=32,this.moverTool.cancelBtn.height=32,this.moverTool.cancelBtn.displayGroup=game.render.uiLayer,this.moverTool.cancelBtn.interactive=!0,this.moverTool.cancelBtn.on("pointerdown",function(){game.ui.clicked=!0,game.tools.setActiveTool("select"),game.tools.closeMenus()}),e=24*game.tileSize,f=10*game.tileSize,1==this.data.dirs?this.moverTool.rotateBtn=!1:(this.moverTool.rotateBtn=new WorldObject(0,0,game.render.newTexture(game.render.tilesets.gui,e,f,64,64)),this.moverTool.rotateBtn.width=64,this.moverTool.rotateBtn.height=64,this.moverTool.rotateBtn.displayGroup=game.render.uiLayer,this.moverTool.rotateBtn.interactive=!0,this.moverTool.rotateBtn.on("pointerdown",function(){game.ui.clicked=!0,3<=game.tools.direction?game.tools.direction=0:game.tools.direction++}),game.render.world.addChild(this.moverTool.rotateBtn)),game.render.world.addChild(this.moverTool.cancelBtn),this.moverTool.alpha=.15,game.render.world.addChild(this.moverTool)),this.furni.alpha=1,game.render.world.addChild(this.furni),this.createFurni=!1,void 0!==this.data&&null!=this.data.data&&(!0===this.data.data.standArea&&(this.standArea=game.standArea(),game.render.objectLayer.addChild(this.standArea)),!0===this.data.data.standArea2&&(this.standArea2=game.standArea(),game.render.objectLayer.addChild(this.standArea2)),!0===this.data.data.standArea3&&(this.standArea3=game.standArea(),game.render.objectLayer.addChild(this.standArea3)),!0===this.data.data.standArea4&&(this.standArea4=game.standArea(),game.render.objectLayer.addChild(this.standArea4)))),void 0===this.data)this.data={};else if(null==this.data.data)this.data.data={};else if(!0===this.data.data.standArea)switch(game.tools.direction){case 0:this.standArea.x=a,this.standArea.y=b+game.tileSize;break;case 1:this.standArea.x=a,this.standArea.y=b-game.tileSize;break;case 2:this.standArea.x=a+game.tileSize,this.standArea.y=b;break;case 3:this.standArea.x=a-game.tileSize,this.standArea.y=b;}if(!0===this.data.data.standArea2)switch(game.tools.direction){case 0:this.standArea2.x=a,this.standArea2.y=b-game.tileSize;break;case 1:this.standArea2.x=a,this.standArea2.y=b+game.tileSize;break;case 2:this.standArea2.x=a-game.tileSize,this.standArea2.y=b;break;case 3:this.standArea2.x=a+game.tileSize,this.standArea2.y=b;}if(!0===this.data.data.standArea3)switch(game.tools.direction){case 0:this.standArea3.x=a,this.standArea3.y=b;break;case 1:this.standArea3.x=a+game.tileSize,this.standArea3.y=b;break;case 2:this.standArea3.x=a,this.standArea3.y=b-16;break;case 3:this.standArea3.x=a,this.standArea3.y=b+game.tileSize;}if(!0===this.data.data.standArea4)switch(game.tools.direction){case 0:this.standArea4.x=a+game.tileSize,this.standArea4.y=b+game.tileSize;break;case 1:this.standArea4.x=a,this.standArea4.y=b-game.tileSize;break;case 2:this.standArea4.x=a-game.tileSize,this.standArea4.y=b+game.tileSize;break;case 3:this.standArea4.x=a,this.standArea4.y=b+game.tileSize+game.tileSize;}if(this.lastsweep&&(this.furni.tint=16711680),2==this.data.blocks)switch(game.tools.direction){case 0:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize,f+game.tileSize,128,game.tileSize),this.furni.height=game.tileSize,this.furni.width=128;break;case 1:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize,f,128,game.tileSize),this.furni.height=game.tileSize,this.furni.width=128;break;case 2:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize+game.tileSize+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 3:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;}if(3==this.data.blocks&&(this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+1,f,4*game.tileSize,4*game.tileSize),this.furni.height=4*game.tileSize,this.furni.width=4*game.tileSize),5==this.data.blocks&&(this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,2*game.tileSize,2*game.tileSize),this.furni.height=2*game.tileSize,this.furni.width=2*game.tileSize),6==this.data.blocks&&(this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,6*game.tileSize,5*game.tileSize),this.furni.height=5*game.tileSize,this.furni.width=6*game.tileSize),4==this.data.blocks)switch(game.tools.direction){case 0:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 1:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 2:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e+game.tileSize+game.tileSize+game.tileSize,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;break;case 3:this.furni.texture=game.render.newTexture(game.render.tilesets.furni,e,f,game.tileSize,128),this.furni.height=128,this.furni.width=game.tileSize;}if(this.furni.x=void 0===this.data.offsetX?a:a-this.data.offsetX,this.furni.y=void 0===this.data.offsetY?b:b-this.data.offsetY,0==game.world.objects.length&&(this.lastsweep=!0),this.furni.tint=this.lastsweep?16777215:16711680,0<game.world.objects.length){checkIncrementer=50,(isNaN(this.collisionCheckId)||null==this.collisionCheckId||0==this.collisionCheckId)&&(this.fullsweep=!1,this.collisionCheckId=0);var h=this.collisionCheckId,k=this.collisionCheckId+checkIncrementer;k>game.world.objects.length?(this.collisionCheckId=0,k-=k-game.world.objects.length):this.collisionCheckId=k,ABE.infoLog("Last sweep: "+this.lastsweep+"check world objects Start: "+h+"End: "+k);for(var l=h;l<k;l++)if(void 0!==game.world.objects[l]&&"trash"!=game.world.objects[l].name){if(game.world.objects[l].tint=16777215,!0===game.world.objects[l].data.buildFloor&&"brickholder"!=game.world.objects[l].name){ABE.infoLog("brickholder 1");continue}if("allowwall"==this.data.collide&&"brickholder"==game.world.objects[l].name){ABE.infoLog("brickholder 2");continue}if(game.world.rCollision(this.furni,game.world.objects[l])||game.world.rCollision(this.standArea,game.world.objects[l]))return this.fullsweep=!1,game.world.objects[l].tint=16711680,this.furni.tint=16711680,this.collisionCheckId=0,this.canCommit=!1,!1}k>=game.world.objects.length&&(this.fullsweep=!0,this.lastsweep=this.fullsweep,this.canCommit=!0)}},game.ui.tempUnpin=!1,e.deactivate=function(){for(var a=0;a<game.world.objects.length;a++)void 0!==game.world.objects[a]&&void 0!==game.world.objects[a].tint&&(game.world.objects[a].tint=16777215);this.furni!==void 0&&this.furni.destroy(),this.moverTool!==void 0&&this.moverTool.destroy!==void 0&&(this.moverTool.tickBtn.destroy(),this.moverTool.cancelBtn.destroy(),!1!==this.moverTool.rotateBtn&&this.moverTool.rotateBtn.destroy(),this.moverTool.destroy()),this.createFurni=!0,!0===this.data.data.standArea&&this.standArea!==void 0&&(this.standArea.destroy(),game.world.removeObject(this.standArea.id)),!0===this.data.data.standArea2&&this.standArea2!==void 0&&(this.standArea2.destroy(),game.world.removeObject(this.standArea2.id)),!0===this.data.data.standArea3&&this.standArea!==void 0&&(this.standArea3.destroy(),game.world.removeObject(this.standArea3.id)),!0===this.data.data.standArea4&&this.standArea4!==void 0&&(this.standArea4.destroy(),game.world.removeObject(this.standArea4.id))},e.onMouseUp=function(){this.lastsweep=!1},this.activeTool=e}});